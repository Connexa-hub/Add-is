Replit Agent — Comprehensive Implementation Task

Purpose:  implement Opay-style flows and features in an existing app repository (frontend + backend + backend admin panel). 


---

Quick summary (what we want)

1. Login + account verification UX like Opay: users can sign up and access the app but see a persistent "Unverified / KYC needed" state until KYC completes. KYC includes identity fields, selfie, ID document upload, and optional liveness/biometric verification.


2. VTU (airtime/data/electricity) home layout exactly like Opay: large home carousel banners, category rows & cards, network auto-detection from entered phone number, package filtering, and detailed product lists. Banners & products manageable from admin panel.


3. Wallet UX & funding flow integrated with Monnify API, including "Add funds" flow, half-screen card-pay sheet, card tokenization/saving, card display in wallet with masked view and reveal behind transaction PIN. Transaction PIN and fingerprint auth for transactions.


4. Admin panel features to manage banners, promotions, VTU product lists, commission settings, and KYC approvals.


5. Security, test cases, API contracts and DB schema updates provided.




---

Assumptions & environment

Repo contains working frontend and backend skeletons and an admin web app. Use existing code structure and follow current coding conventions.

Backend already uses a database (MongoDB assumed) and currently supports user accounts and some VTU operations (if not, see tasks to add endpoints).

Monnify API is the payment gateway. Agent must use Monnify for card payments and bank transfers (Add funds).

All new API endpoints must be authenticated with JWT. Existing auth flow should be extended.



---

High-level deliverables (MVP + nice-to-have)

MVP (must-have):

KYC workflow endpoints + frontend screens (capture data, upload ID images, selfie). Admin review UI for KYC with approve/reject and status updates.

Login/signup experience with unverified banner and restricted actions until KYC approval (with clear messaging).

VTU home screen UI: banners carousel, categories, cards and products listing. Network auto-detect by phone number. Call backend to fetch products.

Banner management in admin (create banner, target section, image/video toggle, link, start/end dates, active flag).

Add funds with Monnify card flow: half-screen sheet, Monnify auth, capture and tokenise card (vaulted). Save card metadata server-side (masked) and show in wallet.

Transaction PIN & fingerprint setup and enforcement for sensitive operations (transfer, card reveal, airtime purchase).


Nice-to-have:

Biometric login (use platform fingerprint APIs — Android/iOS) to unlock app after login.

Liveness detection for selfie (3rd party optional) or a simple selfie + timestamp + IP check.

Auto-topup suggestions and quick actions on homepage.



---

Detailed tasks

1) Authentication & KYC flow

Frontend:

Modify signup success flow to navigate user into main app but show a persistent top-banner or modal: "Account not verified — complete KYC to unlock features".

Add KYC screens: (a) Personal details form (full name, DOB, address, NIN/ID number, nationality), (b) ID upload screen (front/back), (c) Selfie capture screen (camera capture + preview), (d) Summary & submit.

UX: show progress steps (Step 1 of 3), allow saving draft, show validation messages, show expected review time.


Backend:

DB changes: add kyc object to users collection:

kyc: {
  status: "pending|approved|rejected|not_submitted",
  submittedAt: ISODate,
  reviewedAt: ISODate,
  reviewerId: ObjectId,
  rejectionReason: string,
  personal: { fullName, dob, address, idNumber },
  documents: [{ type: "id_front|id_back|selfie", url, filename, uploadedAt }]
}

Endpoints (all JWT protected where appropriate):

POST /api/kyc/submit — payload: personal fields + document upload references. Creates kyc with status: pending.

GET /api/kyc/status — returns current user's kyc status and timestamps.

GET /api/admin/kyc/list — admin list of pending KYC entries (filters, pagination).

POST /api/admin/kyc/:id/approve — admin approves.

POST /api/admin/kyc/:id/reject — admin rejects with reason.


Document storage: use existing storage (S3/space/hosted) — upload endpoint should accept images and return secure URLs. If not present, implement POST /api/uploads which stores files and returns url.


Admin panel:

Add KYC dashboard with list view, ability to view user details and documents in a modal, approve/reject with reason, and filter/search.

On approve/reject, backend must update kyc.status and optionally push notification/email to user.


Acceptance criteria:

After submitting KYC, user status shows pending and they cannot perform restricted actions (e.g., large transfers), but can perform basic actions if allowed by product rules.

Admin can approve/reject; user sees status change within 5 seconds of action (via websocket/real-time or polling)



---

2) VTU (airtime/data/electricity) UI + admin management

Frontend home screen:

Implement carousel banners at top (swipeable) — load from GET /api/banners?section=home.

Category row (Airtime, Data, Electricity, Cable, Bills) as horiz icons.

When user clicks Airtime:

Show phone input field. After user types a valid phone number (on blur or after x digits), call POST /api/phone/detect or local util to detect network prefix and set the network dropdown automatically.

Allow manual override of network via dropdown.

Upon network selection, fetch GET /api/vtu/products?type=airtime&network=MTN to list products.

Display products as cards grouped in categories (e.g., Quick Topups, Bundles) — show price, vendor, and commission.

Provide filters and search UI.



Backend endpoints:

GET /api/banners?section=home|airtime|data|electricity — returns list of banners for requested section; include mediaType: image|video|gif|html, mediaUrl, targetUrl, weight (for randomization), activeFrom, activeTo.

POST /api/phone/detect — body { phone } returns { network: 'MTN', normalized: '+23480xxxx' }. Implementation: use prefix map or a small library.

GET /api/vtu/products?type=&network=&category=&search= — returns product list. Product schema includes id, title, type (airtime/data), network, denomination, price, vendorCode, category.

Admin endpoints to manage products list: POST/PUT/DELETE /api/admin/vtu/products.


Admin panel:

Add Banners management page: create/edit delete banners, select target sections (multi), upload media (image/video) with validation, set active dates, set weight/priority, and preview.

Add VTU product editor page to manage product items and categories.


Randomization & loading rules:

When home loads, call GET /api/banners?section=home. Backend should return an array prioritized by weight and filtered by date & active flag. Frontend randomly picks one or rotates them in the carousel.


Acceptance criteria:

Entering phone auto-detects the network correctly for the 11- to 13-digit variants commonly used in target market (Nigeria). Manual override is available.

Banners created in admin appear on the corresponding section(s) within 30 seconds and can include video.



---

3) Wallet, Add funds & Monnify integration

Frontend:

'Add funds' screen shows bank account details (if using Monnify transfer) OR card payment option.

When user taps "Pay with card", present a half-screen card payment sheet (modal) that collects card number, expiry, CVV, cardholder name, mobile/OTP UI as required. After successful payment, close sheet and show result screen.

Save card token on success and show it in Wallet > Cards as masked tile.

In wallet, tapping a card flips to show masked details; full PAN only revealed after entering transaction PIN.


Backend & Monnify:

Implement Monnify integration endpoints:

POST /api/payments/monnify/init — creates Monnify virtual transaction (call Monnify to initialize transaction) and returns checkout info.

POST /api/payments/monnify/verify — verify transaction (e.g., after webhook/callback or client call with reference).

POST /api/payments/cards/save — store tokenized card metadata (not PAN or CVV), save Monnify token, last4, brand, expiry, cardId.

POST /api/payments/charge — charge using saved token.


Webhook: POST /api/payments/monnify/webhook to receive payment confirmations and update user wallet balance.


Security and PCI note:

Do not store CVV or full PAN server-side. Only store token, last4, brand, expiry. Ensure transmitted card data follows Monnify SDK expectations.


Acceptance criteria:

Card payment flow successfully charges via Monnify and credited to user wallet.

Saved cards appear in wallet masked. Full reveal requires transaction PIN.



---

4) Transaction PIN and biometric

Transaction PIN:

Endpoint: POST /api/auth/pin/setup (store salted+hashed PIN), POST /api/auth/pin/verify (verify), POST /api/auth/pin/change.

Enforce PIN for actions: card reveal, add funds, transfers, high-value purchases. Add middleware requirePin that validates PIN (or biometric token) before the operation.


Biometric:

Frontend should provide device biometric setup that maps to local device keystore (iOS Keychain/Android Keystore) to unlock the app or bypass PIN. Backend should not store biometric data.

When biometric enabled, store a server-side flag biometricEnabled:true on user profile.


Acceptance criteria:

User can set PIN, change PIN, and use PIN to authorize actions. Biometric unlock works as alternative on compatible devices.



---

5) Card vault UI & security

Save token, last4, issuer, expiry. Show masked **** **** **** 4242 with issuer logo in wallet.

Flip animation: front shows masked PAN and expiry; back shows options (Delete, Set default). To reveal full card number, prompt for PIN and optionally send OTP.

Deleting a card triggers DELETE /api/payments/cards/:cardId and notifies Monnify to remove token if supported.



---

6) Admin features & rules

Banner management (see earlier)

VTU product management

KYC list + reviewer comments

Commission & pricing table editor (admin can set


